# ðŸ›ï¸ NamoNexus Enterprise v3.5.1 (Production Hardened)

> **"From Concept to Concrete: The Sovereign AI Infrastructure for Mental Health"**

## ðŸ’¡ About The Project
NamoNexus Enterprise v3.5.1 à¸„à¸·à¸­à¸£à¹ˆà¸²à¸‡à¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œ (Reference Implementation) à¸‚à¸­à¸‡à¸£à¸°à¸šà¸šà¸›à¸±à¸à¸à¸²à¸›à¸£à¸°à¸”à¸´à¸©à¸à¹Œà¹€à¸žà¸·à¹ˆà¸­à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸žà¸·à¹‰à¸™à¸à¸²à¸™à¸”à¹‰à¸²à¸™à¸ªà¸²à¸˜à¸²à¸£à¸“à¸ªà¸¸à¸‚à¹„à¸—à¸¢ à¸–à¸¹à¸à¸žà¸±à¸’à¸™à¸²à¸•à¹ˆà¸­à¸¢à¸­à¸”à¸ˆà¸²à¸à¹à¸™à¸§à¸„à¸´à¸”à¹€à¸Šà¸´à¸‡à¸›à¸£à¸±à¸Šà¸à¸²à¹ƒà¸™ v1.0 à¹ƒà¸«à¹‰à¸à¸¥à¸²à¸¢à¹€à¸›à¹‡à¸™ **"Production-Grade Engine"** à¸—à¸µà¹ˆà¸žà¸£à¹‰à¸­à¸¡à¸£à¸±à¸šà¸¡à¸·à¸­à¸à¸±à¸š Traffic à¸ˆà¸£à¸´à¸‡à¹ƒà¸™à¹‚à¸£à¸‡à¸žà¸¢à¸²à¸šà¸²à¸¥

à¸£à¸°à¸šà¸šà¸™à¸µà¹‰à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹€à¸›à¹‡à¸™à¹€à¸žà¸µà¸¢à¸‡ Chatbot à¹à¸•à¹ˆà¸„à¸·à¸­ **"à¸«à¸­à¸šà¸±à¸‡à¸„à¸±à¸šà¸à¸²à¸£à¸šà¸´à¸™à¸—à¸²à¸‡à¸­à¸²à¸£à¸¡à¸“à¹Œ" (Emotional Air Traffic Control)** à¸—à¸µà¹ˆà¸—à¸³à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸„à¸±à¸”à¸à¸£à¸­à¸‡ (Triage) à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢à¸§à¸´à¸à¸¤à¸•à¸”à¹‰à¸§à¸¢à¸„à¸§à¸²à¸¡à¹€à¸¡à¸•à¸•à¸²à¹€à¸Šà¸´à¸‡à¸£à¸¸à¸ (Active Karuna) à¹‚à¸”à¸¢à¸£à¸±à¸à¸©à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹„à¸§à¹‰à¹ƒà¸™à¸›à¸£à¸°à¹€à¸—à¸¨à¹„à¸—à¸¢ 100% (Sovereign Grid)

## ðŸš€ Key Features (à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œà¹€à¸”à¹‡à¸”)
* [cite_start]**ðŸ¥ Multi-Modal Triage:** à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸ˆà¸²à¸ 3 à¸¡à¸´à¸•à¸´: à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ (Text), à¸™à¹‰à¸³à¹€à¸ªà¸µà¸¢à¸‡ (Voice Features), à¹à¸¥à¸°à¸ªà¸µà¸«à¸™à¹‰à¸² (Facial Features) [cite: 81-125]
* [cite_start]**ðŸ›¡ï¸ Dhammic Moat (Ethical Kernel):** à¹à¸à¸™à¸à¸¥à¸²à¸‡à¸ˆà¸£à¸´à¸¢à¸˜à¸£à¸£à¸¡à¸—à¸µà¹ˆà¸à¸±à¸‡à¸¥à¸¶à¸à¹ƒà¸™à¸£à¸°à¸”à¸±à¸š Code (Hard-coded constraints) à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¹à¸„à¹ˆ Prompt à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆà¸šà¸™à¸à¸²à¸™à¸‚à¸­à¸‡ "Right Speech", "Compassion", à¹à¸¥à¸° "Mindfulness" [cite: 81-125]
* [cite_start]**âš¡ Non-Blocking Architecture:** à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¸„à¸­à¸‚à¸§à¸”à¸”à¹‰à¸§à¸¢à¸à¸²à¸£à¹à¸¢à¸ Background Tasks à¸­à¸­à¸à¸ˆà¸²à¸ Main Event Loop à¹à¸¥à¸°à¹ƒà¸Šà¹‰ Connection Pool à¸ªà¸³à¸«à¸£à¸±à¸š SQLite (WAL Mode) à¸£à¸­à¸‡à¸£à¸±à¸š Concurrency à¸ªà¸¹à¸‡ [cite: 142-150]
* [cite_start]**ðŸ‡¹ðŸ‡­ Sovereign Grid Intelligence:** à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¹ˆà¸­à¸™à¹„à¸«à¸§à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸¥à¸‡ Local Database (`namo_nexus_sovereign.db`) à¸ à¸²à¸¢à¹ƒà¸™à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œà¸­à¸‡à¸„à¹Œà¸à¸£ à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¸£à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¸­à¸à¸™à¸­à¸à¸›à¸£à¸°à¹€à¸—à¸¨ [cite: 112, 142]
* [cite_start]**ðŸ¤ Harmonic Console Bridge:** à¹€à¸•à¸£à¸µà¸¢à¸¡ API à¸žà¸£à¹‰à¸­à¸¡à¸ªà¹ˆà¸‡à¸•à¹ˆà¸­à¹€à¸„à¸ªà¸§à¸´à¸à¸¤à¸•à¹ƒà¸«à¹‰à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸¡à¸™à¸¸à¸©à¸¢à¹Œ à¸žà¸£à¹‰à¸­à¸¡ "Empathy Prompts" à¹à¸™à¸°à¸™à¸³à¸§à¸´à¸˜à¸µà¸à¸²à¸£à¸žà¸¹à¸”à¸„à¸¸à¸¢ [cite: 134-138, 177]

## Release Highlights
Blockers resolved, PDPA/GDPR compliant, Docker secure.

## Harmonic Architecture (Golden Ratio)
```python
GOLDEN_RATIO = (1 + 5**0.5) / 2


def calculate_harmonic_risk(primary_risk: float, secondary_risk: float) -> float:
    blended = (primary_risk * GOLDEN_RATIO + secondary_risk) / (GOLDEN_RATIO + 1)
    return max(0.0, min(1.0, blended))


def fibonacci_retry(attempt: int, base_seconds: float = 0.5, max_seconds: float = 30.0) -> float:
    if attempt <= 0:
        return 0.0
    a, b = 0, 1
    for _ in range(attempt):
        a, b = b, a + b
    delay = a * base_seconds
    return max(0.0, min(delay, max_seconds))
```

## ðŸ› ï¸ Tech Stack
* **Core:** Python 3.11, FastAPI
* **Database:** SQLite (WAL Mode) with Thread-safe Connection Pool
* **Deployment:** Docker, Docker Compose (Optimized for Production)
* **Performance:** Async/Await Concurrency + Background Tasks

## ðŸ“¦ Quick Start
```bash
# 1. Clone & Enter
git clone https://github.com/icezingza/NamoNexus-Enterprise-v3.5.1.git
cd NamoNexus-Enterprise-v3.5.1

# 2. Deploy with Docker (One-click)
docker-compose up -d --build

# 3. Verify System Health
curl http://localhost:8000/health
```

# NamoNexus Enterprise v3.5.1

NamoNexus Enterprise is a FastAPI service for emotion-aware conversations with safety checks,
alignment guidance, and persistent memory. It exposes a lightweight API for
production use and keeps advanced research modules under the `research/` directory.

## Features
- Emotion analysis and tone detection
- Safety screening with escalation handling
- Personalized responses with alignment insights
- SQLAlchemy persistence and Alembic migrations
- Metrics, health, and readiness endpoints
- Rate limiting on `/triage` (and aliases `/interact`, `/reflect`)

## v3.5.1 scope (production)
Included:
- EmotionService (keyword-based Thai/English)
- SafetyService (crisis detection + escalation)
- DharmaService (alignment analysis)
- PersonalizationEngine (response templates)
- MemoryService (SQLAlchemy ORM)
- Health/readiness probes and metrics

Research-only (v2.0+):
- IntegrityKernel and supervisor chain
- Temporal reasoning and simulation modules
- Experimental emotion models

## Quick start
Requirements: Python 3.11+

1. Create a virtual environment:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Windows: venv\Scripts\activate
   ```
2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```
3. Initialize the database:
   ```bash
   alembic upgrade head
   ```
4. Start the API:
   ```bash
   python main.py
   ```

The API listens on `http://localhost:8000` by default.

For a lightweight dev stack without auth/Celery, use `python src/main.py`.

Optional frontend: open `frontend/index.html` for the Harmonic Alignment Console.

## Configuration
Copy `.env.example` to `.env` and adjust values as needed.

Core settings:
- `API_HOST`, `API_PORT`
- `DEBUG`, `LOG_LEVEL`
- `DATABASE_URL`
- `AUTO_CREATE_DB`
- `MAX_MEMORY_ITEMS`, `MEMORY_RETENTION_DAYS`

Enterprise API settings (main.py):
- `NAMO_NEXUS_TOKEN` (required; generated at startup if missing)
- `DB_PATH`
- `CORS_ALLOW_ORIGINS`
- `RATE_LIMIT_PER_MINUTE`, `RATE_LIMIT_BURST`

Advanced stack settings live under `NAMO_*` variables (see `.env.example`).

Set `AUTO_CREATE_DB=true` only for local dev convenience; production should use Alembic migrations.

## API endpoints (primary: `main.py`)
- `GET /health` - Health and version
- `GET /healthz` - Liveness probe (alias)
- `GET /ready` - Readiness probe
- `GET /readyz` - Readiness alias
- `GET /metrics` - Prometheus metrics
- `POST /triage` - Primary triage endpoint (requires `Authorization: Bearer <token>`)
- `POST /interact` - Alias for `/triage` (requires auth)
- `POST /reflect` - Alias for `/triage` (requires auth)
- `GET /harmonic-console` - Global metrics (requires auth)
- `GET /harmonic-console/{session_id}` - Session view (requires auth)

Lightweight dev stack (`src/main.py`) exposes `/interact`, `/reflect`, `/healthz`, `/readyz`, and `/api/status` without auth.

Example request:
```bash
curl -X POST http://localhost:8000/triage \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $NAMO_NEXUS_TOKEN" \
  -d '{"user_id":"user_123","message":"I feel anxious about tomorrow"}'
```

Example response:
```json
{
  "response": "...",
  "risk_level": "moderate",
  "dharma_score": 0.72,
  "emotional_tone": "supportive",
  "multimodal_confidence": 0.75,
  "latency_ms": 12.3,
  "session_id": "session_a1b2c3d4e5f6",
  "human_handoff_required": false,
  "empathy_prompts": null
}
```

The request body accepts `message` and `user_id` with optional `session_id`, `voice_features`, and `facial_features`.

## Database and migrations
```bash
alembic revision --autogenerate -m "Describe change"
alembic upgrade head
alembic current
alembic history
```

Default (SQLite): `sqlite:///./namonexus.db`

For PostgreSQL, set `DATABASE_URL` to:
```
postgresql://namonexus:password@db:5432/namonexus
```

## Testing
```bash
pytest src/tests/ -v
pytest src/tests/ --cov=src --cov-report=html
```

Live API check (Windows):
```powershell
powershell -ExecutionPolicy Bypass -File test_api_live.ps1
```

Diagnostics:
- Windows: `diagnostic.ps1`
- Linux/Mac: `diagnostic.sh`

## Docker
Build:
```bash
docker build -t namonexus:3.5.1 .
```

Run:
```bash
docker run -p 8000:8080 -e PORT=8080 namonexus:3.5.1
```

## Docker Compose
```bash
docker compose up --build
```

To use PostgreSQL, update `DATABASE_URL` in `.env` and run:
```bash
docker compose --profile postgres up --build
```

## Project structure
```
namonexus/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ utils/
â”‚   â””â”€â”€ main.py
â”œâ”€â”€ research/
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ app/
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ migrations/
â”œâ”€â”€ frontend/
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ alembic.ini
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

Production services live under `src/services/`. Legacy modules under `src/*_service.py`
remain for backward compatibility and are not wired to the API.

## Troubleshooting
Port already in use:
```bash
# Linux/Mac
lsof -i :8000
# Windows
netstat -ano | findstr :8000
```

Reset local SQLite database:
```bash
rm namonexus.db
alembic upgrade head
```

Run a single test:
```bash
pytest src/tests/test_api.py::test_health_endpoint -v
```

## License
Licensed under the NamoNexus Commercial License. See LICENSE-COMMERCIAL.
