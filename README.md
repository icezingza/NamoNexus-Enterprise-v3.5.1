# üèõÔ∏è NamoNexus Enterprise v3.5.1 (Production Hardened)

> **"From Concept to Concrete: The Sovereign AI Infrastructure for Mental Health"**

## üí° About The Project
NamoNexus Enterprise v3.5.1 ‡∏Ñ‡∏∑‡∏≠‡∏£‡πà‡∏≤‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå (Reference Implementation) ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç‡πÑ‡∏ó‡∏¢ ‡∏ñ‡∏π‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏à‡∏≤‡∏Å‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤‡πÉ‡∏ô v1.0 ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô **"Production-Grade Engine"** ‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ö Traffic ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•

‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á Chatbot ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∑‡∏≠ **"‡∏´‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå" (Emotional Air Traffic Control)** ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á (Triage) ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏ï‡∏ï‡∏≤‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∏‡∏Å (Active Karuna) ‡πÇ‡∏î‡∏¢‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ 100% (Sovereign Grid)

## üöÄ Key Features (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏î‡πá‡∏î)
* [cite_start]**üè• Multi-Modal Triage:** ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏à‡∏≤‡∏Å 3 ‡∏°‡∏¥‡∏ï‡∏¥: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Text), ‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Voice Features), ‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏´‡∏ô‡πâ‡∏≤ (Facial Features) [cite: 81-125]
* [cite_start]**üõ°Ô∏è Dhammic Moat (Ethical Kernel):** ‡πÅ‡∏Å‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ù‡∏±‡∏á‡∏•‡∏∂‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö Code (Hard-coded constraints) ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà Prompt ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ö‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á "Right Speech", "Compassion", ‡πÅ‡∏•‡∏∞ "Mindfulness" [cite: 81-125]
* [cite_start]**‚ö° Non-Blocking Architecture:** ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏≠‡∏Ç‡∏ß‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å Background Tasks ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Main Event Loop ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ Connection Pool ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SQLite (WAL Mode) ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Concurrency ‡∏™‡∏π‡∏á [cite: 142-150]
* [cite_start]**üáπüá≠ Sovereign Grid Intelligence:** ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡∏á Local Database (`namo_nexus_sovereign.db`) ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡∏ô‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® [cite: 112, 142]
* [cite_start]**ü§ù Harmonic Console Bridge:** ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° API ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏™‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏° "Empathy Prompts" ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢ [cite: 134-138, 177]

## üõ†Ô∏è Tech Stack
* **Core:** Python 3.11, FastAPI
* **Database:** SQLite (WAL Mode) with Thread-safe Connection Pool
* **Deployment:** Docker, Docker Compose (Optimized for Production)
* **Performance:** Async/Await Concurrency + Background Tasks

## üì¶ Quick Start
```bash
# 1. Clone & Enter
git clone [https://github.com/your-org/namo-nexus-enterprise-v3.git](https://github.com/your-org/namo-nexus-enterprise-v3.git)
cd namo-nexus-enterprise-v3

# 2. Deploy with Docker (One-click)
docker-compose up -d --build

# 3. Verify System Health
curl http://localhost:8000/health
```

# NamoNexus Enterprise v3.5.1

NamoNexus Enterprise is a FastAPI service for emotion-aware conversations with safety checks,
alignment guidance, and persistent memory. It exposes a lightweight API for
production use and keeps advanced research modules under the `research/` directory.

## Features
- Emotion analysis and tone detection
- Safety screening with escalation handling
- Personalized responses with alignment insights
- SQLAlchemy persistence and Alembic migrations
- Metrics, health, and readiness endpoints
- Rate limiting on `/interact` and `/reflect`

## v3.5.1 scope (production)
Included:
- EmotionService (keyword-based Thai/English)
- SafetyService (crisis detection + escalation)
- DharmaService (alignment analysis)
- PersonalizationEngine (response templates)
- MemoryService (SQLAlchemy ORM)
- Health/readiness probes and metrics

Research-only (v2.0+):
- IntegrityKernel and supervisor chain
- Temporal reasoning and simulation modules
- Experimental emotion models

## Quick start
Requirements: Python 3.11+

1. Create a virtual environment:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Windows: venv\Scripts\activate
   ```
2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```
3. Initialize the database:
   ```bash
   alembic upgrade head
   ```
4. Start the API:
   ```bash
   python src/main.py
   ```

The API listens on `http://localhost:8000` by default.

Optional frontend: open `frontend/index.html` for the Harmonic Alignment Console.

## Configuration
Copy `.env.example` to `.env` and adjust values as needed.

Core settings:
- `API_HOST`, `API_PORT`
- `DEBUG`, `LOG_LEVEL`
- `DATABASE_URL`
- `AUTO_CREATE_DB`
- `MAX_MEMORY_ITEMS`, `MEMORY_RETENTION_DAYS`

Advanced stack settings live under `NAMO_*` variables (see `.env.example`).

Set `AUTO_CREATE_DB=true` only for local dev convenience; production should use Alembic migrations.

## API endpoints
- `GET /health` - Health and version
- `GET /healthz` - Liveness probe
- `GET /readyz` - Readiness probe with latency metrics
- `GET /metrics` - Prometheus metrics or JSON summary
- `GET /api/status` - Service status
- `POST /interact` - Main interaction endpoint (rate limited)
- `POST /reflect` - Alias for `/interact` (rate limited)

Example request:
```bash
curl -X POST http://localhost:8000/interact \
  -H "Content-Type: application/json" \
  -d '{"user_id":"user_123","message":"I feel anxious about tomorrow"}'
```

Example response:
```json
{
  "user_id": "user_123",
  "response": "...",
  "reflection_text": "...",
  "tone": "anxiety",
  "risk_level": "low",
  "risk_score": 0.25,
  "coherence": 0.85,
  "moral_index": 0.9,
  "ethical_score": 0.88,
  "decision_consistency": 0.82,
  "recommendations": ["..."]
}
```

The request body accepts `message` or `text`.

## Database and migrations
```bash
alembic revision --autogenerate -m "Describe change"
alembic upgrade head
alembic current
alembic history
```

Default (SQLite): `sqlite:///./namonexus.db`

For PostgreSQL, set `DATABASE_URL` to:
```
postgresql://namonexus:password@db:5432/namonexus
```

## Testing
```bash
pytest src/tests/ -v
pytest src/tests/ --cov=src --cov-report=html
```

Live API check (Windows):
```powershell
powershell -ExecutionPolicy Bypass -File test_api_live.ps1
```

Diagnostics:
- Windows: `diagnostic.ps1`
- Linux/Mac: `diagnostic.sh`

## Docker
Build:
```bash
docker build -t namonexus:3.5.1 .
```

Run:
```bash
docker run -p 8000:8080 -e PORT=8080 namonexus:3.5.1
```

## Docker Compose
```bash
docker compose up --build
```

To use PostgreSQL, update `DATABASE_URL` in `.env` and run:
```bash
docker compose --profile postgres up --build
```

## Project structure
```
namonexus/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ research/
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ migrations/
‚îú‚îÄ‚îÄ frontend/
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ alembic.ini
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md
```

Production services live under `src/services/`. Legacy modules under `src/*_service.py`
remain for backward compatibility and are not wired to the API.

## Troubleshooting
Port already in use:
```bash
# Linux/Mac
lsof -i :8000
# Windows
netstat -ano | findstr :8000
```

Reset local SQLite database:
```bash
rm namonexus.db
alembic upgrade head
```

Run a single test:
```bash
pytest src/tests/test_api.py::test_health_endpoint -v
```

## License
Licensed under the MIT License. See LICENSE.
